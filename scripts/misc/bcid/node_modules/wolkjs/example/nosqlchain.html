<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous">
	<title>Wolk NoSQL Blockchain Demo</title>
</head>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="./../dist/wolk.min.js"></script>
<script>
	localStorage.clear();
	var nosqlchain = new WOLK("http://localhost:34000");
</script>
<style>
	body {
		margin: 50px 50px;
	}
</style>
<body>
	<div>
		<h2>Wolk NoSQL Blockchain Demo</h2>
	</div>

	<br>

	<div>
		<div class="form-group">
			<h5>Owner: demo.eth</h5>
		</div>
		<br>
		<div class="form-group">
		  <h5>Set Blockchain ID</h5>
	      <input type="text" class="form-control" id="setidInput" placeholder="Your NoSQL Blockchain ID">
	    </div>
	    <button class="btn btn-primary" type="button" id="setidBtn">Set</button>
	</div>

	<br>

	<div>
		<h5>Current Block Number: <span id="currentblocknum"></span></h5>
		<button class="btn btn-primary" type="button" id="refreshBtn">Refresh</button>
	</div>

	<br>

	<div>
		<h4>SetKey</h4>
		<div>
		  <div class="form-row">
		    <div class="form-group col-md-6">
		      <label for="">Key</label>
		      <input type="text" class="form-control" id="inputsetkey" placeholder="Key">
		    </div>
		    <div class="form-group col-md-6">
		      <label for="">Value</label>
		      <input type="text" class="form-control" id="inputsetvalue" placeholder="Value">
		    </div>
		  </div>
		  <button class="btn btn-primary" type="button" id="setkeyBtn">Set</button>
		</div>
	</div>

	<br>

	<div>
		<h4>GetKey</h4>
		<div>
		  <div class="form-row">
		    <div class="form-group col-md-6">
		      <label for="">Key</label>
		      <input type="text" class="form-control" id="inputgetkey" placeholder="Key">
		    </div>
		    <div class="form-group col-md-6">
		      <label for="">Block Number (Optional)</label>
		      <input type="text" class="form-control" id="inputgetblocknum" placeholder="Block Number">
		    </div>
		  </div>
		  <button class="btn btn-primary" type="button" id="getkeyBtn">Get</button>
		</div>
	</div>
</body>
<script>
	document.getElementById("setidBtn").addEventListener("click", function(){ 
		localStorage.setItem("blockchainid", document.getElementById("setidInput").value);
		alert("blockchainID is saved!");
	});

	document.getElementById("setkeyBtn").addEventListener("click", function(){
		var blockchainID = localStorage.getItem("blockchainid");
		var key = document.getElementById("inputsetkey").value;
		var value = document.getElementById("inputsetvalue").value;
		nosqlchain.setKey(blockchainID, key, value, function(error, result) {
			if (error) {
				alert(JSON.stringify(error));
			}
			else {
				alert(JSON.stringify(result));
			}
		})
	});

	document.getElementById("getkeyBtn").addEventListener("click", function(){
		var blockchainID = localStorage.getItem("blockchainid");
		var key = document.getElementById("inputgetkey").value;
		var blocknumvalue = document.getElementById("inputgetblocknum").value;
		var blocknum = blocknumvalue ? blocknumvalue : "latest";
		nosqlchain.getKey(blockchainID, key, blocknum, function(error, result) {
			if (error) {
				alert(JSON.stringify(error));
			}
			else {
				alert(JSON.stringify(result));
			}
		})
	});

	document.getElementById("refreshBtn").addEventListener("click", function(){
		var blockchainID = localStorage.getItem("blockchainid");
		nosqlchain.nosqlLatestBlockNumber(blockchainID, function(error, result) {
			if (error) {
				alert(JSON.stringify(error));
			}
			else {
				document.getElementById("currentblocknum").innerHTML = result.blocknumber;
			}
		})
	});
</script>
</html>