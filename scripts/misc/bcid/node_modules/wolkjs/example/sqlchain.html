<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous">
	<title>Wolk SQL Blockchain Demo</title>
</head>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="./../dist/wolk.min.js"></script>
<script>
	localStorage.clear();
	var sqlchain = new WOLK("http://localhost:24000");
	var owner = "demo.eth";
</script>
<style>
	body {
		margin: 50px 50px;
	}
</style>
<body>
	<div>
		<h2>Wolk SQL Blockchain Demo</h2>
	</div>

	<br>

	<div>
		<div class="form-group">
			<h5>Owner: demo.eth</h5>
		</div>
		<br>
		<div class="form-group">
		  <h5>Set Blockchain ID</h5>
	      <input type="text" class="form-control" id="setidInput" placeholder="Your SQL Blockchain ID">
	    </div>
	    <button class="btn btn-primary" type="button" id="setidBtn">Set</button>
	</div>

	<br>

	<div>
		<h5>Check your database list</h5>
		<button class="btn btn-primary" type="button" id="listdbBtn">List</button>
	</div>

	<br>

	<div>
		<h5>Create new database</h5>
		<div class="form-group">
	      <input type="text" class="form-control" id="createdbInput" placeholder="New database name">
	    </div>
	    <button class="btn btn-primary" type="button" id="createdbBtn">Create</button>
	</div>

	<br>

	<div>
		<h5>Connect to database</h5>
		<div class="form-group">
	      <input type="text" class="form-control" id="connectdbInput" placeholder="Which database to connect">
	    </div>
	    <button class="btn btn-primary" type="button" id="connectdbBtn">Connect</button>
	</div>	

	<br>

	<div>
		<h5>Current Block Number: <span id="currentblocknum"></span></h5>
		<button class="btn btn-primary" type="button" id="refreshBtn">Refresh</button>
	</div>

	<br>

	<div>
		<h4>Run Query</h4>
		<div>
		  <div class="form-row">
			<div class="form-group col-md-12">
			  <label for="">SQL Query:</label>
			  <textarea class="form-control" rows="5" id="textareaquery"></textarea>
			</div>
		    <div class="form-group col-md-12">
		      <label for="">Block Number (Optional)</label>
		      <input type="text" class="form-control" id="inputgetblocknum" placeholder="Block Number">
		    </div>
		  </div>
		  <button class="btn btn-primary" type="button" id="runBtn">Run</button>
		</div>
	</div>
</body>
<script>
	document.getElementById("setidBtn").addEventListener("click", function(){ 
		localStorage.setItem("blockchainid", document.getElementById("setidInput").value);
		alert("blockchainID is saved!");
	});

	document.getElementById("connectdbBtn").addEventListener("click", function(){ 
		localStorage.setItem("dbname", document.getElementById("connectdbInput").value);
		alert("database is connected!");
	});

	document.getElementById("runBtn").addEventListener("click", function(){
		var blockchainID = localStorage.getItem("blockchainid");
		var dbname = localStorage.getItem("dbname");
		var query = document.getElementById("textareaquery").value;
		var blocknumvalue = document.getElementById("inputgetblocknum").value;
		var txn = { "requesttype":"Query", "owner":owner, "database":dbname, "query": query};
		if (blocknumvalue) {
			txn["blocknumber"] = parseInt(blocknumvalue, 10);
		}
		sqlchain.exec(blockchainID, txn, function(error, result) {
			if (error) {
				alert(JSON.stringify(error));
			}
			else {
				alert(JSON.stringify(result));
			}
		})
	});

	document.getElementById("refreshBtn").addEventListener("click", function(){
		var blockchainID = localStorage.getItem("blockchainid");
		sqlchain.sqlLatestBlockNumber(blockchainID, function(error, result) {
			if (error) {
				alert(JSON.stringify(error));
			}
			else {
				document.getElementById("currentblocknum").innerHTML = result.blocknumber;
			}
		})
	});

	document.getElementById("listdbBtn").addEventListener("click", function(){
		var blockchainID = localStorage.getItem("blockchainid");
		sqlchain.exec(blockchainID, { "requesttype":"ListDatabases", "encrypted":1, "owner":owner }, function(error, result) {
			if (error) {
				alert(JSON.stringify(error));
			}
			else {
				alert(JSON.stringify(result));
			}
		})
	});

	document.getElementById("createdbBtn").addEventListener("click", function(){
		var blockchainID = localStorage.getItem("blockchainid");
		var dbname = document.getElementById("createdbInput").value;
		sqlchain.exec(blockchainID, { "requesttype":"CreateDatabase", "encrypted":1, "owner":owner, "database":dbname}, function(error, result) {
			if (error) {
				alert(JSON.stringify(error));
			}
			else {
				alert(JSON.stringify(result));
			}
		})
	});
</script>
</html>