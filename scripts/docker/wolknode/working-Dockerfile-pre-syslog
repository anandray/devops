FROM centos

COPY bin/bootnode /usr/bin/bootnode
COPY bin/geth /usr/bin/geth
COPY bin/swarm /usr/bin/swarm

COPY scripts/geth-start.sh /wolk/scripts/geth-start.sh
COPY scripts/geth-start-crontab.sh /wolk/scripts/geth-start-crontab.sh
COPY scripts/swarm-start-firsttime.sh /wolk/scripts/swarm-start-firsttime.sh
COPY scripts/hi.sh /wolk/scripts/hi.sh
COPY scripts/genesis.json.sh /wolk/scripts/genesis.json.sh
#COPY /var/lib/mlocate/mlocate.db /var/lib/mlocate/

#RUN yum -y install mlocate
#RUN /usr/bin/updatedb
#RUN grep -s "self=enode:" `locate bootnode.log | head -n1` | awk '{print$6}' | cut -d "=" -f2 | cut -d "@" -f1 > /wolk/scripts/enode.txt
#RUN grep -s 'addr=' `locate geth.log`  | head -n1 | awk '{print$4}' | cut -d "=" -f2 | cut -d ":" -f1 > /wolk/scripts/ip.txt

RUN unlink /etc/localtime
RUN ln -s /usr/share/zoneinfo/America/Los_Angeles /etc/localtime
RUN yum -y install crontabs epel-release iproute libdbi-devel mlocate net-tools sudo syslog-ng syslog-ng-libdbi telnet vim wget which
RUN echo "# start swarm syslogging

filter f_log6 { match("wolk-debug" value("PROGRAM")) or match("wolk-trace" value("PROGRAM")) or match("wolk-cloud" value("PROGRAM")) or match("wolk-mining" value("PROGRAM")) or match("wolk-mining" value("PROGRAM")) or match("wolk-tcp" value("PROGRAM")) or match("wolk-http" value("PROGRAM")); };

#filter f_log6 { match("ethereum-debug" value("PROGRAM")) or match("wolk-debug" value("PROGRAM")); };
destination log6 {        tcp("log6" port (5000));};
log { source(s_sys); filter(f_log6); destination(log6); };

# /end swarm syslogging" >> /etc/syslog-ng/conf.d/swarm-syslog.conf
RUN /bin/systemctl restart syslog-ng.service
RUN /usr/sbin/chkconfig syslog-ng on
RUN echo "alias vi='vim'" >> ~/.bashrc
ENTRYPOINT "/wolk/scripts/geth-start.sh" ; "/wolk/scripts/hi.sh" ; "/wolk/scripts/geth-start-crontab.sh" ; "crond" ; /bin/bash
